import{S as V,M as B,a as $,g as Q,E,e as Y,P as Z,b as ee,D as te,N as f,c as M,d as F,F as A}from"./index-zV_s9h5k.js";const re=new V({nodes:{doc:{content:"block+"},paragraph:{content:"inline*",group:"block",parseDOM:[{tag:"p"}],toDOM(){return["p",0]}},blockquote:{content:"block+",group:"block",parseDOM:[{tag:"blockquote"}],toDOM(){return["blockquote",0]}},horizontal_rule:{group:"block",parseDOM:[{tag:"hr"}],toDOM(){return["div",["hr"]]}},heading:{attrs:{level:{default:1}},content:"(text | image)*",group:"block",defining:!0,parseDOM:[{tag:"h1",attrs:{level:1}},{tag:"h2",attrs:{level:2}},{tag:"h3",attrs:{level:3}},{tag:"h4",attrs:{level:4}},{tag:"h5",attrs:{level:5}},{tag:"h6",attrs:{level:6}}],toDOM(t){return["h"+t.attrs.level,0]}},code_block:{content:"text*",group:"block",code:!0,defining:!0,marks:"",attrs:{params:{default:""}},parseDOM:[{tag:"pre",preserveWhitespace:"full",getAttrs:t=>({params:t.getAttribute("data-params")||""})}],toDOM(t){return["pre",t.attrs.params?{"data-params":t.attrs.params}:{},["code",0]]}},ordered_list:{content:"list_item+",group:"block",attrs:{order:{default:1},tight:{default:!1}},parseDOM:[{tag:"ol",getAttrs(t){return{order:t.hasAttribute("start")?+t.getAttribute("start"):1,tight:t.hasAttribute("data-tight")}}}],toDOM(t){return["ol",{start:t.attrs.order==1?null:t.attrs.order,"data-tight":t.attrs.tight?"true":null},0]}},bullet_list:{content:"list_item+",group:"block",attrs:{tight:{default:!1}},parseDOM:[{tag:"ul",getAttrs:t=>({tight:t.hasAttribute("data-tight")})}],toDOM(t){return["ul",{"data-tight":t.attrs.tight?"true":null},0]}},list_item:{content:"block+",defining:!0,parseDOM:[{tag:"li"}],toDOM(){return["li",0]}},text:{group:"inline"},image:{inline:!0,attrs:{src:{},alt:{default:null},title:{default:null}},group:"inline",draggable:!0,parseDOM:[{tag:"img[src]",getAttrs(t){return{src:t.getAttribute("src"),title:t.getAttribute("title"),alt:t.getAttribute("alt")}}}],toDOM(t){return["img",t.attrs]}},hard_break:{inline:!0,group:"inline",selectable:!1,parseDOM:[{tag:"br"}],toDOM(){return["br"]}}},marks:{em:{parseDOM:[{tag:"i"},{tag:"em"},{style:"font-style=italic"},{style:"font-style=normal",clearMark:t=>t.type.name=="em"}],toDOM(){return["em"]}},strong:{parseDOM:[{tag:"strong"},{tag:"b",getAttrs:t=>t.style.fontWeight!="normal"&&null},{style:"font-weight=400",clearMark:t=>t.type.name=="strong"},{style:"font-weight",getAttrs:t=>/^(bold(er)?|[5-9]\d{2,})$/.test(t)&&null}],toDOM(){return["strong"]}},link:{attrs:{href:{},title:{default:null}},inclusive:!1,parseDOM:[{tag:"a[href]",getAttrs(t){return{href:t.getAttribute("href"),title:t.getAttribute("title")}}}],toDOM(t){return["a",t.attrs]}},code:{code:!0,parseDOM:[{tag:"code"}],toDOM(){return["code"]}}}});function ne(t,e){if(t.isText&&e.isText&&$.sameSet(t.marks,e.marks))return t.withText(t.text+e.text)}class ie{constructor(e,r){this.schema=e,this.tokenHandlers=r,this.stack=[{type:e.topNodeType,attrs:null,content:[],marks:$.none}]}top(){return this.stack[this.stack.length-1]}push(e){this.stack.length&&this.top().content.push(e)}addText(e){if(!e)return;let r=this.top(),n=r.content,i=n[n.length-1],a=this.schema.text(e,r.marks),s;i&&(s=ne(i,a))?n[n.length-1]=s:n.push(a)}openMark(e){let r=this.top();r.marks=e.addToSet(r.marks)}closeMark(e){let r=this.top();r.marks=e.removeFromSet(r.marks)}parseTokens(e){for(let r=0;r<e.length;r++){let n=e[r],i=this.tokenHandlers[n.type];if(!i)throw new Error("Token type `"+n.type+"` not supported by Markdown parser");i(this,n,e,r)}}addNode(e,r,n){let i=this.top(),a=e.createAndFill(r,n,i?i.marks:[]);return a?(this.push(a),a):null}openNode(e,r){this.stack.push({type:e,attrs:r,content:[],marks:$.none})}closeNode(){let e=this.stack.pop();return this.addNode(e.type,e.attrs,e.content)}}function T(t,e,r,n){return t.getAttrs?t.getAttrs(e,r,n):t.attrs instanceof Function?t.attrs(e):t.attrs}function _(t,e){return t.noCloseToken||e=="code_inline"||e=="code_block"||e=="fence"}function D(t){return t[t.length-1]==`
`?t.slice(0,t.length-1):t}function L(){}function se(t,e){let r=Object.create(null);for(let n in e){let i=e[n];if(i.block){let a=t.nodeType(i.block);_(i,n)?r[n]=(s,u,d,c)=>{s.openNode(a,T(i,u,d,c)),s.addText(D(u.content)),s.closeNode()}:(r[n+"_open"]=(s,u,d,c)=>s.openNode(a,T(i,u,d,c)),r[n+"_close"]=s=>s.closeNode())}else if(i.node){let a=t.nodeType(i.node);r[n]=(s,u,d,c)=>s.addNode(a,T(i,u,d,c))}else if(i.mark){let a=t.marks[i.mark];_(i,n)?r[n]=(s,u,d,c)=>{s.openMark(a.create(T(i,u,d,c))),s.addText(D(u.content)),s.closeMark(a)}:(r[n+"_open"]=(s,u,d,c)=>s.openMark(a.create(T(i,u,d,c))),r[n+"_close"]=s=>s.closeMark(a))}else if(i.ignore)_(i,n)?r[n]=L:(r[n+"_open"]=L,r[n+"_close"]=L);else throw new RangeError("Unrecognized parsing spec "+JSON.stringify(i))}return r.text=(n,i)=>n.addText(i.content),r.inline=(n,i)=>n.parseTokens(i.children),r.softbreak=r.softbreak||(n=>n.addText(" ")),r}let ae=class{constructor(e,r,n){this.schema=e,this.tokenizer=r,this.tokens=n,this.tokenHandlers=se(e,n)}parse(e,r={}){let n=new ie(this.schema,this.tokenHandlers),i;n.parseTokens(this.tokenizer.parse(e,r));do i=n.closeNode();while(n.stack.length);return i||this.schema.topNodeType.createAndFill()}};function I(t,e){for(;++e<t.length;)if(t[e].type!="list_item_open")return t[e].hidden;return!1}new ae(re,B("commonmark",{html:!1}),{blockquote:{block:"blockquote"},paragraph:{block:"paragraph"},list_item:{block:"list_item"},bullet_list:{block:"bullet_list",getAttrs:(t,e,r)=>({tight:I(e,r)})},ordered_list:{block:"ordered_list",getAttrs:(t,e,r)=>({order:+t.attrGet("start")||1,tight:I(e,r)})},heading:{block:"heading",getAttrs:t=>({level:+t.tag.slice(1)})},code_block:{block:"code_block",noCloseToken:!0},fence:{block:"code_block",getAttrs:t=>({params:t.info||""}),noCloseToken:!0},hr:{node:"horizontal_rule"},image:{node:"image",getAttrs:t=>({src:t.attrGet("src"),title:t.attrGet("title")||null,alt:t.children[0]&&t.children[0].content||null})},hardbreak:{node:"hard_break"},em:{mark:"em"},strong:{mark:"strong"},link:{mark:"link",getAttrs:t=>({href:t.attrGet("href"),title:t.attrGet("title")||null})},code_inline:{mark:"code",noCloseToken:!0}});const oe={open:"",close:"",mixable:!0};let le=class{constructor(e,r,n={}){this.nodes=e,this.marks=r,this.options=n}serialize(e,r={}){r=Object.assign({},this.options,r);let n=new R(this.nodes,this.marks,r);return n.renderContent(e),n.out}};const m=new le({blockquote(t,e){t.wrapBlock("> ",null,e,()=>t.renderContent(e))},code_block(t,e){const r=e.textContent.match(/`{3,}/gm),n=r?r.sort().slice(-1)[0]+"`":"```";t.write(n+(e.attrs.params||"")+`
`),t.text(e.textContent,!1),t.write(`
`),t.write(n),t.closeBlock(e)},heading(t,e){t.write(t.repeat("#",e.attrs.level)+" "),t.renderInline(e,!1),t.closeBlock(e)},horizontal_rule(t,e){t.write(e.attrs.markup||"---"),t.closeBlock(e)},bullet_list(t,e){t.renderList(e,"  ",()=>(e.attrs.bullet||"*")+" ")},ordered_list(t,e){let r=e.attrs.order||1,n=String(r+e.childCount-1).length,i=t.repeat(" ",n+2);t.renderList(e,i,a=>{let s=String(r+a);return t.repeat(" ",n-s.length)+s+". "})},list_item(t,e){t.renderContent(e)},paragraph(t,e){t.renderInline(e),t.closeBlock(e)},image(t,e){t.write("!["+t.esc(e.attrs.alt||"")+"]("+e.attrs.src.replace(/[\(\)]/g,"\\$&")+(e.attrs.title?' "'+e.attrs.title.replace(/"/g,'\\"')+'"':"")+")")},hard_break(t,e,r,n){for(let i=n+1;i<r.childCount;i++)if(r.child(i).type!=e.type){t.write(`\\
`);return}},text(t,e){t.text(e.text,!t.inAutolink)}},{em:{open:"*",close:"*",mixable:!0,expelEnclosingWhitespace:!0},strong:{open:"**",close:"**",mixable:!0,expelEnclosingWhitespace:!0},link:{open(t,e,r,n){return t.inAutolink=ce(e,r,n),t.inAutolink?"<":"["},close(t,e,r,n){let{inAutolink:i}=t;return t.inAutolink=void 0,i?">":"]("+e.attrs.href.replace(/[\(\)"]/g,"\\$&")+(e.attrs.title?` "${e.attrs.title.replace(/"/g,'\\"')}"`:"")+")"},mixable:!0},code:{open(t,e,r,n){return H(r.child(n),-1)},close(t,e,r,n){return H(r.child(n-1),1)},escape:!1}});function H(t,e){let r=/`+/g,n,i=0;if(t.isText)for(;n=r.exec(t.text);)i=Math.max(i,n[0].length);let a=i>0&&e>0?" `":"`";for(let s=0;s<i;s++)a+="`";return i>0&&e<0&&(a+=" "),a}function ce(t,e,r){if(t.attrs.title||!/^\w+:/.test(t.attrs.href))return!1;let n=e.child(r);return!n.isText||n.text!=t.attrs.href||n.marks[n.marks.length-1]!=t?!1:r==e.childCount-1||!t.isInSet(e.child(r+1).marks)}let R=class{constructor(e,r,n){this.nodes=e,this.marks=r,this.options=n,this.delim="",this.out="",this.closed=null,this.inAutolink=void 0,this.atBlockStart=!1,this.inTightList=!1,typeof this.options.tightLists>"u"&&(this.options.tightLists=!1),typeof this.options.hardBreakNodeName>"u"&&(this.options.hardBreakNodeName="hard_break")}flushClose(e=2){if(this.closed){if(this.atBlank()||(this.out+=`
`),e>1){let r=this.delim,n=/\s+$/.exec(r);n&&(r=r.slice(0,r.length-n[0].length));for(let i=1;i<e;i++)this.out+=r+`
`}this.closed=null}}getMark(e){let r=this.marks[e];if(!r){if(this.options.strict!==!1)throw new Error(`Mark type \`${e}\` not supported by Markdown renderer`);r=oe}return r}wrapBlock(e,r,n,i){let a=this.delim;this.write(r??e),this.delim+=e,i(),this.delim=a,this.closeBlock(n)}atBlank(){return/(^|\n)$/.test(this.out)}ensureNewLine(){this.atBlank()||(this.out+=`
`)}write(e){this.flushClose(),this.delim&&this.atBlank()&&(this.out+=this.delim),e&&(this.out+=e)}closeBlock(e){this.closed=e}text(e,r=!0){let n=e.split(`
`);for(let i=0;i<n.length;i++)this.write(),!r&&n[i][0]=="["&&/(^|[^\\])\!$/.test(this.out)&&(this.out=this.out.slice(0,this.out.length-1)+"\\!"),this.out+=r?this.esc(n[i],this.atBlockStart):n[i],i!=n.length-1&&(this.out+=`
`)}render(e,r,n){if(this.nodes[e.type.name])this.nodes[e.type.name](this,e,r,n);else{if(this.options.strict!==!1)throw new Error("Token type `"+e.type.name+"` not supported by Markdown renderer");e.type.isLeaf||(e.type.inlineContent?this.renderInline(e):this.renderContent(e),e.isBlock&&this.closeBlock(e))}}renderContent(e){e.forEach((r,n,i)=>this.render(r,e,i))}renderInline(e,r=!0){this.atBlockStart=r;let n=[],i="",a=(s,u,d)=>{let c=s?s.marks:[];s&&s.type.name===this.options.hardBreakNodeName&&(c=c.filter(o=>{if(d+1==e.childCount)return!1;let l=e.child(d+1);return o.isInSet(l.marks)&&(!l.isText||/\S/.test(l.text))}));let g=i;if(i="",s&&s.isText&&c.some(o=>{let l=this.getMark(o.type.name);return l&&l.expelEnclosingWhitespace&&!o.isInSet(n)})){let[o,l,h]=/^(\s*)(.*)$/m.exec(s.text);l&&(g+=l,s=h?s.withText(h):null,s||(c=n))}if(s&&s.isText&&c.some(o=>{let l=this.getMark(o.type.name);return l&&l.expelEnclosingWhitespace&&(d==e.childCount-1||!o.isInSet(e.child(d+1).marks))})){let[o,l,h]=/^(.*?)(\s*)$/m.exec(s.text);h&&(i=h,s=l?s.withText(l):null,s||(c=n))}let k=c.length?c[c.length-1]:null,v=k&&this.getMark(k.type.name).escape===!1,w=c.length-(v?1:0);e:for(let o=0;o<w;o++){let l=c[o];if(!this.getMark(l.type.name).mixable)break;for(let h=0;h<n.length;h++){let p=n[h];if(!this.getMark(p.type.name).mixable)break;if(l.eq(p)){o>h?c=c.slice(0,h).concat(l).concat(c.slice(h,o)).concat(c.slice(o+1,w)):h>o&&(c=c.slice(0,o).concat(c.slice(o+1,h)).concat(l).concat(c.slice(h,w)));continue e}}}let x=0;for(;x<Math.min(n.length,w)&&c[x].eq(n[x]);)++x;for(;x<n.length;)this.text(this.markString(n.pop(),!1,e,d),!1);if(g&&this.text(g),s){for(;n.length<w;){let o=c[n.length];n.push(o),this.text(this.markString(o,!0,e,d),!1),this.atBlockStart=!1}v&&s.isText?this.text(this.markString(k,!0,e,d)+s.text+this.markString(k,!1,e,d+1),!1):this.render(s,e,d),this.atBlockStart=!1}s!=null&&s.isText&&s.nodeSize>0&&(this.atBlockStart=!1)};e.forEach(a),a(null,0,e.childCount),this.atBlockStart=!1}renderList(e,r,n){this.closed&&this.closed.type==e.type?this.flushClose(3):this.inTightList&&this.flushClose(1);let i=typeof e.attrs.tight<"u"?e.attrs.tight:this.options.tightLists,a=this.inTightList;this.inTightList=i,e.forEach((s,u,d)=>{d&&i&&this.flushClose(1),this.wrapBlock(r,n(d),e,()=>this.render(s,e,d))}),this.inTightList=a}esc(e,r=!1){return e=e.replace(/[`*\\~\[\]_]/g,(n,i)=>n=="_"&&i>0&&i+1<e.length&&e[i-1].match(/\w/)&&e[i+1].match(/\w/)?n:"\\"+n),r&&(e=e.replace(/^(\+[ ]|[\-*>])/,"\\$&").replace(/^(\s*)(#{1,6})(\s|$)/,"$1\\$2$3").replace(/^(\s*\d+)\.\s/,"$1\\. ")),this.options.escapeExtraCharacters&&(e=e.replace(this.options.escapeExtraCharacters,"\\$&")),e}quote(e){let r=e.indexOf('"')==-1?'""':e.indexOf("'")==-1?"''":"()";return r[0]+e+r[1]}repeat(e,r){let n="";for(let i=0;i<r;i++)n+=e;return n}markString(e,r,n,i){let a=this.getMark(e.type.name),s=r?a.open:a.close;return typeof s=="string"?s:s(this,e,n,i)}getEnclosingWhitespace(e){return{leading:(e.match(/^(\s+)/)||[void 0])[0],trailing:(e.match(/(\s+)$/)||[void 0])[0]}}};var z,P;function de(){if(P)return z;P=1;var t=!0,e=!1,r=!1;z=function(o,l){l&&(t=!l.enabled,e=!!l.label,r=!!l.labelAfter),o.core.ruler.after("inline","github-task-lists",function(h){for(var p=h.tokens,b=2;b<p.length;b++)a(p,b)&&(s(p[b],h.Token),n(p[b-2],"class","task-list-item"+(t?"":" enabled")),n(p[i(p,b-2)],"class","contains-task-list"))})};function n(o,l,h){var p=o.attrIndex(l),b=[l,h];p<0?o.attrPush(b):o.attrs[p]=b}function i(o,l){for(var h=o[l].level-1,p=l-1;p>=0;p--)if(o[p].level===h)return p;return-1}function a(o,l){return k(o[l])&&v(o[l-1])&&w(o[l-2])&&x(o[l])}function s(o,l){if(o.children.unshift(u(o,l)),o.children[1].content=o.children[1].content.slice(3),o.content=o.content.slice(3),e)if(r){o.children.pop();var h="task-item-"+Math.ceil(Math.random()*(1e4*1e3)-1e3);o.children[0].content=o.children[0].content.slice(0,-1)+' id="'+h+'">',o.children.push(g(o.content,h,l))}else o.children.unshift(d(l)),o.children.push(c(l))}function u(o,l){var h=new l("html_inline","",0),p=t?' disabled="" ':"";return o.content.indexOf("[ ] ")===0?h.content='<input class="task-list-item-checkbox"'+p+'type="checkbox">':(o.content.indexOf("[x] ")===0||o.content.indexOf("[X] ")===0)&&(h.content='<input class="task-list-item-checkbox" checked=""'+p+'type="checkbox">'),h}function d(o){var l=new o("html_inline","",0);return l.content="<label>",l}function c(o){var l=new o("html_inline","",0);return l.content="</label>",l}function g(o,l,h){var p=new h("html_inline","",0);return p.content='<label class="task-list-item-label" for="'+l+'">'+o+"</label>",p.attrs=[{for:l}],p}function k(o){return o.type==="inline"}function v(o){return o.type==="paragraph_open"}function w(o){return o.type==="list_item_open"}function x(o){return o.content.indexOf("[ ] ")===0||o.content.indexOf("[x] ")===0||o.content.indexOf("[X] ")===0}return z}var he=de();const ue=Q(he);var pe=Object.defineProperty,fe=(t,e,r)=>e in t?pe(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,y=(t,e,r)=>(fe(t,typeof e!="symbol"?e+"":e,r),r);const ge=E.create({name:"markdownTightLists",addOptions:()=>({tight:!0,tightClass:"tight",listTypes:["bulletList","orderedList"]}),addGlobalAttributes(){return[{types:this.options.listTypes,attributes:{tight:{default:this.options.tight,parseHTML:t=>t.getAttribute("data-tight")==="true"||!t.querySelector("p"),renderHTML:t=>({class:t.tight?this.options.tightClass:null,"data-tight":t.tight?"true":null})}}}]},addCommands(){var t=this;return{toggleTight:function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;return r=>{let{editor:n,commands:i}=r;function a(s){if(!n.isActive(s))return!1;const u=n.getAttributes(s);return i.updateAttributes(s,{tight:e??!(u!=null&&u.tight)})}return t.options.listTypes.some(s=>a(s))}}}}}),q=B();function G(t,e){return q.inline.State.prototype.scanDelims.call({src:t,posMax:t.length}),new q.inline.State(t,null,null,[]).scanDelims(e,!0)}function X(t,e,r,n){let i=t.substring(0,r)+t.substring(r+e.length);return i=i.substring(0,r+n)+e+i.substring(r+n),i}function me(t,e,r,n){let i=r,a=t;for(;i<n&&!G(a,i).can_open;)a=X(a,e,i,1),i++;return{text:a,from:i,to:n}}function ke(t,e,r,n){let i=n,a=t;for(;i>r&&!G(a,i).can_close;)a=X(a,e,i,-1),i--;return{text:a,from:r,to:i}}function be(t,e,r,n){let i={text:t,from:r,to:n};return i=me(i.text,e,i.from,i.to),i=ke(i.text,e,i.from,i.to),i.to-i.from<e.length+1&&(i.text=i.text.substring(0,i.from)+i.text.substring(i.to+e.length)),i.text}class we extends R{constructor(e,r,n){super(e,r,n??{}),y(this,"inTable",!1),this.inlines=[]}render(e,r,n){super.render(e,r,n);const i=this.inlines[this.inlines.length-1];if(i!=null&&i.start&&i!==null&&i!==void 0&&i.end){const{delimiter:a,start:s,end:u}=this.normalizeInline(i);this.out=be(this.out,a,s,u),this.inlines.pop()}}markString(e,r,n,i){const a=this.marks[e.type.name];if(a.expelEnclosingWhitespace)if(r)this.inlines.push({start:this.out.length,delimiter:a.open});else{const s=this.inlines.pop();this.inlines.push({...s,end:this.out.length})}return super.markString(e,r,n,i)}normalizeInline(e){let{start:r,end:n}=e;for(;this.out.charAt(r).match(/\s/);)r++;return{...e,start:r}}}const U=M.create({name:"markdownHTMLMark",addStorage(){return{markdown:{serialize:{open(t,e){var r,n;return this.editor.storage.markdown.options.html?(r=(n=j(e))===null||n===void 0?void 0:n[0])!==null&&r!==void 0?r:"":(console.warn(`Tiptap Markdown: "${e.type.name}" mark is only available in html mode`),"")},close(t,e){var r,n;return this.editor.storage.markdown.options.html&&(r=(n=j(e))===null||n===void 0?void 0:n[1])!==null&&r!==void 0?r:""}},parse:{}}}}});function j(t){const e=t.type.schema,r=e.text(" ",[t]),i=F(A.from(r),e).match(/^(<.*?>) (<\/.*?>)$/);return i?[i[1],i[2]]:null}function N(t){const e=`<body>${t}</body>`;return new window.DOMParser().parseFromString(e,"text/html").body}function xe(t){return t==null?void 0:t.replace(/</g,"&lt;").replace(/>/g,"&gt;")}function Me(t){const e=t.parentElement,r=e.cloneNode();for(;e.firstChild&&e.firstChild!==t;)r.appendChild(e.firstChild);r.childNodes.length>0&&e.parentElement.insertBefore(r,e),e.parentElement.insertBefore(t,e),e.childNodes.length===0&&e.remove()}function Te(t){const e=t.parentNode;for(;t.firstChild;)e.insertBefore(t.firstChild,t);e.removeChild(t)}const C=f.create({name:"markdownHTMLNode",addStorage(){return{markdown:{serialize(t,e,r){this.editor.storage.markdown.options.html?t.write(ve(e,r)):(console.warn(`Tiptap Markdown: "${e.type.name}" node is only available in html mode`),t.write(`[${e.type.name}]`)),e.isBlock&&t.closeBlock(e)},parse:{}}}}});function ve(t,e){const r=t.type.schema,n=F(A.from(t),r);return t.isBlock&&(e instanceof A||e.type.name===r.topNodeType.name)?ye(n):n}function ye(t){const r=N(t).firstElementChild;return r.innerHTML=r.innerHTML.trim()?`
${r.innerHTML}
`:`
`,r.outerHTML}const Se=f.create({name:"blockquote"}),Ce=Se.extend({addStorage(){return{markdown:{serialize:m.nodes.blockquote,parse:{}}}}}),_e=f.create({name:"bulletList"}),J=_e.extend({addStorage(){return{markdown:{serialize(t,e){return t.renderList(e,"  ",()=>(this.editor.storage.markdown.options.bulletListMarker||"-")+" ")},parse:{}}}}}),Le=f.create({name:"codeBlock"}),ze=Le.extend({addStorage(){return{markdown:{serialize(t,e){t.write("```"+(e.attrs.language||"")+`
`),t.text(e.textContent,!1),t.ensureNewLine(),t.write("```"),t.closeBlock(e)},parse:{setup(t){var e;t.set({langPrefix:(e=this.options.languageClassPrefix)!==null&&e!==void 0?e:"language-"})},updateDOM(t){t.innerHTML=t.innerHTML.replace(/\n<\/code><\/pre>/g,"</code></pre>")}}}}}}),Oe=f.create({name:"hardBreak"}),K=Oe.extend({addStorage(){return{markdown:{serialize(t,e,r,n){for(let i=n+1;i<r.childCount;i++)if(r.child(i).type!=e.type){t.write(t.inTable?C.storage.markdown.serialize.call(this,t,e,r):`\\
`);return}},parse:{}}}}}),$e=f.create({name:"heading"}),Ae=$e.extend({addStorage(){return{markdown:{serialize:m.nodes.heading,parse:{}}}}}),Be=f.create({name:"horizontalRule"}),Ee=Be.extend({addStorage(){return{markdown:{serialize:m.nodes.horizontal_rule,parse:{}}}}}),Ne=f.create({name:"image"}),De=Ne.extend({addStorage(){return{markdown:{serialize:m.nodes.image,parse:{}}}}}),Ie=f.create({name:"listItem"}),He=Ie.extend({addStorage(){return{markdown:{serialize:m.nodes.list_item,parse:{}}}}}),Pe=f.create({name:"orderedList"});function qe(t,e,r){let n=0;for(;r-n>0&&e.child(r-n-1).type.name===t.type.name;n++);return n}const je=Pe.extend({addStorage(){return{markdown:{serialize(t,e,r,n){const i=e.attrs.start||1,a=String(i+e.childCount-1).length,s=t.repeat(" ",a+2),d=qe(e,r,n)%2?") ":". ";t.renderList(e,s,c=>{const g=String(i+c);return t.repeat(" ",a-g.length)+g+d})},parse:{}}}}}),We=f.create({name:"paragraph"}),Fe=We.extend({addStorage(){return{markdown:{serialize:m.nodes.paragraph,parse:{}}}}});function O(t){var e,r;return(e=t==null||(r=t.content)===null||r===void 0?void 0:r.content)!==null&&e!==void 0?e:[]}const Re=f.create({name:"table"}),Ge=Re.extend({addStorage(){return{markdown:{serialize(t,e,r){if(!Xe(e)){C.storage.markdown.serialize.call(this,t,e,r);return}t.inTable=!0,e.forEach((n,i,a)=>{if(t.write("| "),n.forEach((s,u,d)=>{d&&t.write(" | ");const c=s.firstChild;c.textContent.trim()&&t.renderInline(c)}),t.write(" |"),t.ensureNewLine(),!a){const s=Array.from({length:n.childCount}).map(()=>"---").join(" | ");t.write(`| ${s} |`),t.ensureNewLine()}}),t.closeBlock(e),t.inTable=!1},parse:{}}}}});function W(t){return t.attrs.colspan>1||t.attrs.rowspan>1}function Xe(t){const e=O(t),r=e[0],n=e.slice(1);return!(O(r).some(i=>i.type.name!=="tableHeader"||W(i)||i.childCount>1)||n.some(i=>O(i).some(a=>a.type.name==="tableHeader"||W(a)||a.childCount>1)))}const Ue=f.create({name:"taskItem"}),Je=Ue.extend({addStorage(){return{markdown:{serialize(t,e){const r=e.attrs.checked?"[x]":"[ ]";t.write(`${r} `),t.renderContent(e)},parse:{updateDOM(t){[...t.querySelectorAll(".task-list-item")].forEach(e=>{const r=e.querySelector("input");e.setAttribute("data-type","taskItem"),r&&(e.setAttribute("data-checked",r.checked),r.remove())})}}}}}}),Ke=f.create({name:"taskList"}),Ve=Ke.extend({addStorage(){return{markdown:{serialize:J.storage.markdown.serialize,parse:{setup(t){t.use(ue)},updateDOM(t){[...t.querySelectorAll(".contains-task-list")].forEach(e=>{e.setAttribute("data-type","taskList")})}}}}}}),Qe=f.create({name:"text"}),Ye=Qe.extend({addStorage(){return{markdown:{serialize(t,e){t.text(xe(e.text))},parse:{}}}}}),Ze=M.create({name:"bold"}),et=Ze.extend({addStorage(){return{markdown:{serialize:m.marks.strong,parse:{}}}}}),tt=M.create({name:"code"}),rt=tt.extend({addStorage(){return{markdown:{serialize:m.marks.code,parse:{}}}}}),nt=M.create({name:"italic"}),it=nt.extend({addStorage(){return{markdown:{serialize:m.marks.em,parse:{}}}}}),st=M.create({name:"link"}),at=st.extend({addStorage(){return{markdown:{serialize:m.marks.link,parse:{}}}}}),ot=M.create({name:"strike"}),lt=ot.extend({addStorage(){return{markdown:{serialize:{open:"~~",close:"~~",expelEnclosingWhitespace:!0},parse:{}}}}}),ct=[Ce,J,ze,K,Ae,Ee,C,De,He,je,Fe,Ge,Je,Ve,Ye,et,rt,U,it,at,lt];function S(t){var e,r;const n=(e=t.storage)===null||e===void 0?void 0:e.markdown,i=(r=ct.find(a=>a.name===t.name))===null||r===void 0?void 0:r.storage.markdown;return n||i?{...i,...n}:null}class dt{constructor(e){y(this,"editor",null),this.editor=e}serialize(e){const r=new we(this.nodes,this.marks,{hardBreakNodeName:K.name});return r.renderContent(e),r.out}get nodes(){var e;return{...Object.fromEntries(Object.keys(this.editor.schema.nodes).map(r=>[r,this.serializeNode(C)])),...Object.fromEntries((e=this.editor.extensionManager.extensions.filter(r=>r.type==="node"&&this.serializeNode(r)).map(r=>[r.name,this.serializeNode(r)]))!==null&&e!==void 0?e:[])}}get marks(){var e;return{...Object.fromEntries(Object.keys(this.editor.schema.marks).map(r=>[r,this.serializeMark(U)])),...Object.fromEntries((e=this.editor.extensionManager.extensions.filter(r=>r.type==="mark"&&this.serializeMark(r)).map(r=>[r.name,this.serializeMark(r)]))!==null&&e!==void 0?e:[])}}serializeNode(e){var r;return(r=S(e))===null||r===void 0||(r=r.serialize)===null||r===void 0?void 0:r.bind({editor:this.editor,options:e.options})}serializeMark(e){var r;const n=(r=S(e))===null||r===void 0?void 0:r.serialize;return n?{...n,open:typeof n.open=="function"?n.open.bind({editor:this.editor,options:e.options}):n.open,close:typeof n.close=="function"?n.close.bind({editor:this.editor,options:e.options}):n.close}:null}}class ht{constructor(e,r){y(this,"editor",null),y(this,"md",null);let{html:n,linkify:i,breaks:a}=r;this.editor=e,this.md=this.withPatchedRenderer(B({html:n,linkify:i,breaks:a}))}parse(e){let{inline:r}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(typeof e=="string"){this.editor.extensionManager.extensions.forEach(a=>{var s;return(s=S(a))===null||s===void 0||(s=s.parse)===null||s===void 0||(s=s.setup)===null||s===void 0?void 0:s.call({editor:this.editor,options:a.options},this.md)});const n=this.md.render(e),i=N(n);return this.editor.extensionManager.extensions.forEach(a=>{var s;return(s=S(a))===null||s===void 0||(s=s.parse)===null||s===void 0||(s=s.updateDOM)===null||s===void 0?void 0:s.call({editor:this.editor,options:a.options},i)}),this.normalizeDOM(i,{inline:r,content:e}),i.innerHTML}return e}normalizeDOM(e,r){let{inline:n,content:i}=r;return this.normalizeBlocks(e),e.querySelectorAll("*").forEach(a=>{var s;((s=a.nextSibling)===null||s===void 0?void 0:s.nodeType)===Node.TEXT_NODE&&!a.closest("pre")&&(a.nextSibling.textContent=a.nextSibling.textContent.replace(/^\n/,""))}),n&&this.normalizeInline(e,i),e}normalizeBlocks(e){const n=Object.values(this.editor.schema.nodes).filter(i=>i.isBlock).map(i=>{var a;return(a=i.spec.parseDOM)===null||a===void 0?void 0:a.map(s=>s.tag)}).flat().filter(Boolean).join(",");n&&[...e.querySelectorAll(n)].forEach(i=>{i.parentElement.matches("p")&&Me(i)})}normalizeInline(e,r){var n;if((n=e.firstElementChild)!==null&&n!==void 0&&n.matches("p")){var i,a,s,u;const d=e.firstElementChild,{nextElementSibling:c}=d,g=(i=(a=r.match(/^\s+/))===null||a===void 0?void 0:a[0])!==null&&i!==void 0?i:"",k=c?"":(s=(u=r.match(/\s+$/))===null||u===void 0?void 0:u[0])!==null&&s!==void 0?s:"";if(r.match(/^\n\n/)){d.innerHTML=`${d.innerHTML}${k}`;return}Te(d),e.innerHTML=`${g}${e.innerHTML}${k}`}}withPatchedRenderer(e){const r=n=>function(){const i=n(...arguments);return i===`
`?i:i[i.length-1]===`
`?i.slice(0,-1):i};return e.renderer.rules.hardbreak=r(e.renderer.rules.hardbreak),e.renderer.rules.softbreak=r(e.renderer.rules.softbreak),e.renderer.rules.fence=r(e.renderer.rules.fence),e.renderer.rules.code_block=r(e.renderer.rules.code_block),e.renderer.renderToken=r(e.renderer.renderToken.bind(e.renderer)),e}}const ut=E.create({name:"markdownClipboard",addOptions(){return{transformPastedText:!1,transformCopiedText:!1}},addProseMirrorPlugins(){return[new Z({key:new ee("markdownClipboard"),props:{clipboardTextParser:(t,e,r)=>{if(r||!this.options.transformPastedText)return null;const n=this.editor.storage.markdown.parser.parse(t,{inline:!0});return te.fromSchema(this.editor.schema).parseSlice(N(n),{preserveWhitespace:!0,context:e})},clipboardTextSerializer:t=>this.options.transformCopiedText?this.editor.storage.markdown.serializer.serialize(t.content):null}})]}}),kt=E.create({name:"markdown",priority:50,addOptions(){return{html:!0,tightLists:!0,tightListClass:"tight",bulletListMarker:"-",linkify:!1,breaks:!1,transformPastedText:!1,transformCopiedText:!1}},addCommands(){const t=Y.Commands.config.addCommands();return{setContent:(e,r,n)=>i=>t.setContent(i.editor.storage.markdown.parser.parse(e),r,n)(i),insertContentAt:(e,r,n)=>i=>t.insertContentAt(e,i.editor.storage.markdown.parser.parse(r,{inline:!0}),n)(i)}},onBeforeCreate(){this.editor.storage.markdown={options:{...this.options},parser:new ht(this.editor,this.options),serializer:new dt(this.editor),getMarkdown:()=>this.editor.storage.markdown.serializer.serialize(this.editor.state.doc)},this.editor.options.initialContent=this.editor.options.content,this.editor.options.content=this.editor.storage.markdown.parser.parse(this.editor.options.content)},onCreate(){this.editor.options.content=this.editor.options.initialContent,delete this.editor.options.initialContent},addStorage(){return{}},addExtensions(){return[ge.configure({tight:this.options.tightLists,tightClass:this.options.tightListClass}),ut.configure({transformPastedText:this.options.transformPastedText,transformCopiedText:this.options.transformCopiedText})]}});export{kt as Markdown};
